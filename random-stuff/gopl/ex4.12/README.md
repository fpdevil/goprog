# Exercise 4.12 XKCD

The popular web comic `xkcd` has a `json` interface. For example, a request to `https://xkcd.com/571/info.0.json` produces a detailed description of comic *571*. Download each `URL` (once!) and build  an offline index. Write a tool `xkcd` that, using this index prints the `URL` and `transcript` of each comic that matches a search term provided on the command line.

## JSON data

Here is the `json` obtained from `xkcd`.

```json
{
  "month": "4",
  "num": 571,
  "link": "",
  "year": "2009",
  "news": "",
  "safe_title": "Can't Sleep",
  "transcript": "[[Someone is in bed, presumably trying to sleep. The top of each panel is a thought bubble showing sheep leaping over a fence.]]\n1 ... 2 ...\n<<baaa>>\n[[Two sheep are jumping from left to right.]]\n\n... 1,306 ... 1,307 ...\n<<baaa>>\n[[Two sheep are jumping from left to right. The would-be sleeper is holding his pillow.]]\n\n... 32,767 ... -32,768 ...\n<<baaa>> <<baaa>> <<baaa>> <<baaa>> <<baaa>>\n[[A whole flock of sheep is jumping over the fence from right to left. The would-be sleeper is sitting up.]]\nSleeper: ?\n\n... -32,767 ... -32,766 ...\n<<baaa>>\n[[Two sheep are jumping from left to right. The would-be sleeper is holding his pillow over his head.]]\n\n{{Title text: If androids someday DO dream of electric sheep, don't forget to declare sheepCount as a long int.}}",
  "alt": "If androids someday DO dream of electric sheep, don't forget to declare sheepCount as a long int.",
  "img": "https://imgs.xkcd.com/comics/cant_sleep.png",
  "title": "Can't Sleep",
  "day": "20"
}
```

We use the excellent `json` to `go struct` converter tool [json-to-go] to convert the raw response into a struct.

Here is the `go type` generated from the metadata.

```go
type AutoGenerated struct {
	Month      string `json:"month"`
	Num        int    `json:"num"`
	Link       string `json:"link"`
	Year       string `json:"year"`
	News       string `json:"news"`
	SafeTitle  string `json:"safe_title"`
	Transcript string `json:"transcript"`
	Alt        string `json:"alt"`
	Img        string `json:"img"`
	Title      string `json:"title"`
	Day        string `json:"day"`
}
```

## Example run

- Run 1
```bash
⇒  go run main.go -from 1910 -to 1920 -keyword Spot
ERRO[0000] error while reading index open index.json: no such file or directory  file=index.json function=New
INFO[0000] building index between the interval.          index from=0xc00001c328 index to=0xc00001c330 program=main.go
INFO[0000] calling url https://xkcd.com/1910/info.0.json
INFO[0000] calling url https://xkcd.com/1911/info.0.json
INFO[0000] calling url https://xkcd.com/1912/info.0.json
INFO[0000] calling url https://xkcd.com/1913/info.0.json
INFO[0000] calling url https://xkcd.com/1914/info.0.json
INFO[0000] calling url https://xkcd.com/1915/info.0.json
INFO[0000] calling url https://xkcd.com/1916/info.0.json
INFO[0000] calling url https://xkcd.com/1917/info.0.json
INFO[0000] calling url https://xkcd.com/1918/info.0.json
INFO[0000] calling url https://xkcd.com/1919/info.0.json
---------------------------------------------------------------------------
Found Comic ID:            1910
URL: https://imgs.xkcd.com/comics/sky_spotters.png
Alt: Where I live, one of the most common categories of sky object without a weird obsessive spotting community is "lost birthday party balloons," so that might be a good choice—although you risk angering the marine wildlife people, and they have sharks.
---------------------------------------------------------------------------
```

- Run 2
```bash
⇒  go run main.go -from 1910 -to 1920 -keyword Interstellar
INFO[0000] building index between the interval.          index from=0xc0000b22a0 index to=0xc0000b22a8 program=main.go
---------------------------------------------------------------------------
Found Comic ID:            1919
URL: https://imgs.xkcd.com/comics/interstellar_asteroid.png
Alt: Every time we detect an asteroid from outside the Solar System, we should immediately launch a mission to fling one of our asteroids back in the direction it came from.
---------------------------------------------------------------------------
```

- Run 3
```bash
⇒  go run main.go -from 100 -to 150 -keyword Delicious
INFO[0000] building index between the interval.          index from=0xc0000b22a0 index to=0xc0000b22a8 program=main.go
INFO[0000] calling url https://xkcd.com/100/info.0.json
INFO[0000] calling url https://xkcd.com/101/info.0.json
INFO[0000] calling url https://xkcd.com/102/info.0.json
INFO[0000] calling url https://xkcd.com/103/info.0.json
INFO[0000] calling url https://xkcd.com/104/info.0.json
INFO[0000] calling url https://xkcd.com/105/info.0.json
INFO[0000] calling url https://xkcd.com/106/info.0.json
INFO[0000] calling url https://xkcd.com/107/info.0.json
INFO[0000] calling url https://xkcd.com/108/info.0.json
INFO[0000] calling url https://xkcd.com/109/info.0.json
INFO[0000] calling url https://xkcd.com/110/info.0.json
INFO[0000] calling url https://xkcd.com/111/info.0.json
INFO[0000] calling url https://xkcd.com/112/info.0.json
INFO[0000] calling url https://xkcd.com/113/info.0.json
INFO[0000] calling url https://xkcd.com/114/info.0.json
INFO[0000] calling url https://xkcd.com/115/info.0.json
INFO[0001] calling url https://xkcd.com/116/info.0.json
INFO[0001] calling url https://xkcd.com/117/info.0.json
INFO[0001] calling url https://xkcd.com/118/info.0.json
INFO[0001] calling url https://xkcd.com/119/info.0.json
INFO[0001] calling url https://xkcd.com/120/info.0.json
INFO[0001] calling url https://xkcd.com/121/info.0.json
INFO[0001] calling url https://xkcd.com/122/info.0.json
INFO[0001] calling url https://xkcd.com/123/info.0.json
INFO[0001] calling url https://xkcd.com/124/info.0.json
INFO[0001] calling url https://xkcd.com/125/info.0.json
INFO[0001] calling url https://xkcd.com/126/info.0.json
INFO[0001] calling url https://xkcd.com/127/info.0.json
INFO[0001] calling url https://xkcd.com/128/info.0.json
INFO[0001] calling url https://xkcd.com/129/info.0.json
INFO[0001] calling url https://xkcd.com/130/info.0.json
INFO[0001] calling url https://xkcd.com/131/info.0.json
INFO[0001] calling url https://xkcd.com/132/info.0.json
INFO[0001] calling url https://xkcd.com/133/info.0.json
INFO[0001] calling url https://xkcd.com/134/info.0.json
INFO[0001] calling url https://xkcd.com/135/info.0.json
INFO[0001] calling url https://xkcd.com/136/info.0.json
INFO[0001] calling url https://xkcd.com/137/info.0.json
INFO[0001] calling url https://xkcd.com/138/info.0.json
INFO[0001] calling url https://xkcd.com/139/info.0.json
INFO[0001] calling url https://xkcd.com/140/info.0.json
INFO[0002] calling url https://xkcd.com/141/info.0.json
INFO[0002] calling url https://xkcd.com/142/info.0.json
INFO[0002] calling url https://xkcd.com/143/info.0.json
INFO[0002] calling url https://xkcd.com/144/info.0.json
INFO[0002] calling url https://xkcd.com/145/info.0.json
INFO[0002] calling url https://xkcd.com/146/info.0.json
INFO[0002] calling url https://xkcd.com/147/info.0.json
INFO[0002] calling url https://xkcd.com/148/info.0.json
INFO[0002] calling url https://xkcd.com/149/info.0.json
---------------------------------------------------------------------------
Found Comic ID:             140
URL: https://imgs.xkcd.com/comics/delicious.png
Transcript:
Frame is split by a diagonal
First half: guy in front of open fridge
Second half: guy with bag of chips
---------------------------------------------------------------------------
```

- Run 4
```bash
⇒  go run main.go -from 100 -to 150 -keyword Delicious
INFO[0000] building index between the interval.          index from=0xc00011c2a0 index to=0xc00011c2a8 program=main.go
---------------------------------------------------------------------------
Found Comic ID:             140
URL: https://imgs.xkcd.com/comics/delicious.png
Transcript:
Frame is split by a diagonal
First half: guy in front of open fridge
Second half: guy with bag of chips
---------------------------------------------------------------------------
```

[json-to-go]: https://mholt.github.io/json-to-go/
